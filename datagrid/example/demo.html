<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../liger-common.css">
    <link rel="stylesheet" href="../ligerui-grid.css">
    <link rel="stylesheet" href="../../bower_components/pager/index.css" media="screen" title="no title" charset="utf-8">
    <!--<link rel="stylesheet/less" href="../../bower_components/legoland/src/legoland.css" media="screen" title="no title" charset="utf-8">-->
    <title>Title</title>
</head>
<body>
<div>
    <div id="maingrid4" style="margin: 0; padding: 0">
    </div>
</div>
<div>
<div id="maingrid"></div>
    </div>
<!--<script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.3/less.min.js"></script>-->
<script src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript" src="../../bower_components/class/index.js"></script>
<script type="text/javascript" src="../../bower_components/pager/index.js"></script>
<script src="../ligerui.all.js"></script>
<script type="text/javascript" src="demo1.js"></script>
<script type="text/javascript" src="treeData.js"></script>
<script type="text/javascript">
    var g;
    $(function ()
    {
        g = $("#maingrid4").ligerGrid({
            columns: [
                {display: '主键', name: 'CustomerID', align: 'left', width: 120 } ,
                { display: '公司名', name: 'CompanyName', minWidth: 60 },
                { display: '联系名1', name: 'ContactName', width: 100, align: 'left', frozen: true },
                { display: '联系名2', name: 'ContactName', width: 200, align: 'left' },
                { display: '联系名3', name: 'ContactName', width: 200, align: 'left' },
                { display: '联系名4', name: 'ContactName', width: 200, align: 'left', frozen: true },
                { display: '城市', name: 'City', width: 200 }
            ], data: CustomersData, pageSize: 10, sortName: 'CustomerID',
            width: '98%', height: '98%',rownumbers:true,
            fixedCellHeight:false,
            usePager:false
        });
        $("#pageloading").hide();
        $("#maingrid4").find("table").addClass('lg-table');
        $(".l-grid2").css({left:parseInt($(".l-grid2").position().left-5)+"px"});


//            $(".l-grid-body").each(function (k,d) {
//
//                var $d=$(d);
//                $(d).find(".l-grid-row td").each(function (i,dom) {
//                    var w=$(dom).width();
//                    $d.parent().find(".l-grid-header td:eq("+i+")").css({width:w+"px"});
//                });
//                $d.find(".l-grid-body-inner").css({width:$d.find("table").width()+"px"})
//            });




    });




    var manager;
    $(function ()
    {
        manager = $("#maingrid").ligerGrid({
                    columns: [
                        { display: '部门名', name: 'name', id: 'id1', width: 250, align: 'left' },
                        { display: '部门标示', name: 'id', width: 250, type: 'int', align: 'left' },

                        { display: '部门描述', name: 'remark', width: 250, align: 'left' }
                    ], width: '100%', pageSizeOptions: [5, 10, 15, 20], height: '97%',
                    data: TreeDeptData, alternatingRow: false, tree: { columnId: 'id1',usePager:false }
                }
        );

//
//        $(".l-grid-body").each(function (k,d) {
//
//            var $d=$(d);
//
//            $(d).find(".l-grid-row:first td").each(function (i,dom) {
//                var w=$(dom).find(".l-grid-row-cell-inner").width();
//                var w1=$d.parent().find(".l-grid-header td:eq("+i+")").width();
//                console.log(w,w1);
//                if(w<w1){
//                    console.log("w1");
//                    $(dom).find(".l-grid-row-cell-inner").css({width:w1+"pxt"});
//                    $d.parent().find(".l-grid-header td:eq("+i+") .l-grid-hd-cell-inner").css({width:w1+"px"});
//                    console.log($(dom).find(".l-grid-row-cell-inner"),92929);
//
//                }else{
//                    console.log("w");
//                    $(dom).find(".l-grid-row-cell-inner").css({width:w+"pxt"});
//                    $d.parent().find(".l-grid-header td:eq("+i+") .l-grid-hd-cell-inner").css({width:w+"px"});
//                    console.log($d.parent().find(".l-grid-header td:eq("+i+") .l-grid-hd-cell-inner"))
//                }
//
//            });
//        });


        $("#maingrid").find(".l-grid-detailpanel-inner .l-grid-body").each(function (k,d) {
            var $d = $(d);
            var headerTd = [];
            $d.parent().find(".l-grid-header td").each(function (m, o) {
                if ($(o).prop("colspan") == 1) {
                    headerTd.push($(o));
                }
            });
            console.log(headerTd);
            var headerTd2 = {}, idIndex = [];
            headerTd.forEach(function (q, l) {
                console.log(q.prop("id"));
                var idArgs = q.prop("id").split("|");
                idIndex.push(idArgs[2]);
            });
            var idIndex2 = idIndex.sort();
            console.log(idIndex2);
            idIndex2.forEach(function (o, m) {
                headerTd.forEach(function (q, l) {
                    if(q.prop("id").indexOf(o)>-1){
                        headerTd2[m]=q;
                    }
                });

            });
            var wArgs={};
            $(d).find(".l-grid-row:first td").each(function (i, dom) {
                var w = $(dom).find(".l-grid-row-cell-inner").width();
                var w1 = headerTd2[i].width();
                console.log(w, w1);
                if (w < w1) {
                    console.log(w1,"w1");
                    wArgs[i]=w1;
                    console.log(  $(dom).find(".l-grid-row-cell-inner"));
                    $(dom).find(".l-grid-row-cell-inner").css({width: w1 + "px"});
                    headerTd2[i].find(".l-grid-hd-cell-inner").css({width: w1 + "px"});
                } else {
                    console.log("w");
                    console.log(i);
                    wArgs[i]=w;
                    //                        l-grid-row-cell-inner
                    headerTd2[i].find(".l-grid-hd-cell-inner").css({width: w + "px"});
                    $(dom).find(".l-grid-row-cell-inner").css({width: w + "px"});
                }
            });

            $(d).find(".l-grid-row").each(function (i, dom) {
                $(dom).find("td").each(function(k,d){
                    $(d).find(".l-grid-row-cell-inner").css({width:wArgs[k]+"px"});
                });
            });

            //                $(".l-grid-detailpanel-inner").css({width: W + "px"});
        });
        setTimeout(function(){
            $("#maingrid").find(".l-grid-body").each(function (k,d) {
                //                    var $d=$(d);
                //                    var w=$d.find("table").width();
                //                    $d.css({width:w+"px"});
                //                    $d.parents(".l-panel-body").first().css({width:w+"px",margin:"0 auto"});


                var $d=$(d);
                var w=$d.find("table").width();
                /*当不锁定列时在显示*/
//                $d.css({width:w+"px"});
//                $d.parents(".l-panel-body").first().css({width:w+"px",margin:"0 auto"});
//                $d.parents(".l-grid1").first().css({width:w+"px"});
//                $d.parents(".l-grid").first().find(".l-grid2").first().css({width:w+"px"});
//                $d.parents(".l-grid").first().find(".l-grid2 .l-grid-header-inner").first().css({width:w+"px"});

                var h1=$d.parents(".l-grid").first().find(".l-grid1 .l-grid-header").height();
                var h2=$d.parents(".l-grid").first().find(".l-grid2 .l-grid-header").height();
                console.log(h1,h2,8787);
                if(h1>h2){
                    $d.parents(".l-grid").first().find(".l-grid1 .l-grid-header .l-grid-header-table").height(h1);
                    $d.parents(".l-grid").first().find(".l-grid2 .l-grid-header .l-grid-header-table").height(h1);
                }else{
                    $d.parents(".l-grid").first().find(".l-grid1 .l-grid-header .l-grid-header-table").height(h2);
                    $d.parents(".l-grid").first().find(".l-grid2 .l-grid-header .l-grid-header-table").height(h2);
                }
            })
        },10);

    });
    function getParent()
    {
        var row = manager.getParent(manager.getSelectedRow());
        alert(JSON.stringify(row));
    }
    function getSelected()
    {
        var row = manager.getSelectedRow();
        if (!row) { alert('请选择行'); return; }
        alert(JSON.stringify(row));
    }
    function getData()
    {
        var data = manager.getData();
        alert(JSON.stringify(data));
    }
    function hasChildren()
    {
        var row = manager.getSelectedRowObj();
        alert(manager.hasChildren(row));
    }
    function isLeaf()
    {
        var row = manager.getSelectedRowObj();
        alert(manager.isLeaf(row));
    }
    function collapseAll()
    {
        manager.collapseAll();
    }
    function expandAll()
    {
        manager.expandAll();
    }
</script>
</body>
</html>